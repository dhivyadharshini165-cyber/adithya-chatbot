<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Adithya College</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Segoe UI, Arial;
    background:#f5f7fb;
    margin:0;
    padding:30px;
}

h1{
    color:#0f172a;
}

.section{
    background:white;
    padding:25px;
    margin-bottom:30px;
    border-radius:16px;
    box-shadow:0 15px 30px rgba(0,0,0,0.15);
}

.top-bar{
    display:flex;
    justify-content:flex-end;
    margin-bottom:20px;
}

.logout{
    background:#111;
    color:white;
    border:none;
    padding:10px 18px;
    border-radius:8px;
    cursor:pointer;
}

table{
    width:100%;
    border-collapse:collapse;
}

th, td{
    padding:12px;
    border-bottom:1px solid #ddd;
    text-align:left;
}

th{
    background:#eef2ff;
}

.delete{
    background:#dc2626;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:6px;
    cursor:pointer;
}

.full{
    background:#111;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:6px;
    cursor:pointer;
}

.search{
    width:100%;
    padding:12px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid #ccc;
}
</style>
</head>

<body>

<div class="top-bar">
    <a href="/logout">
        <button class="logout">Logout</button>
    </a>
</div>

<h1>Admin Dashboard</h1>

<!-- OPTION 1: APPLICATIONS CHART -->
<div class="section">
    <h2>Applications Per Course</h2>
    <canvas id="courseChart"></canvas>
</div>

<!-- OPTION 2: COURSE STATUS CONTROL -->
<div class="section">
    <h2>Course Status</h2>

    {% for c, s in course_status.items() %}
    <p>
        <b>{{ c }}</b> :
        {% if s == "open" %}
            <a href="/course-status/{{ c }}/full">
                <button class="full">Mark FULL</button>
            </a>
        {% else %}
            ðŸš« FULL
            <a href="/course-status/{{ c }}/open">
                <button class="full">Re-Open</button>
            </a>
        {% endif %}
    </p>
    {% endfor %}
</div>

<!-- OPTION 3: STUDENT APPLICATIONS LIST -->
<div class="section">
    <h2>Student Applications</h2>

    <!-- OPTION 4: SEARCH -->
    <input type="text" id="search" class="search" placeholder="Search students...">

    <table>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Course</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Date</th>
            <th>Time</th>
            <th>Action</th>
        </tr>

        {% for s in students %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ s.name }}</td>
            <td>{{ s.course }}</td>
            <td>{{ s.phone }}</td>
            <td>{{ s.email }}</td>
            <td>{{ s.date }}</td>
            <td>{{ s.time }}</td>
            <td>
                <!-- OPTION 5: DELETE -->
                <a href="/delete-application/{{ loop.index0 }}">
                    <button class="delete">Delete</button>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
// CHART
new Chart(document.getElementById("courseChart"),{
    type:"bar",
    data:{
        labels: {{ labels | tojson }},
        datasets:[{
            label:"Applications",
            data: {{ counts | tojson }},
            backgroundColor:"#4f46e5"
        }]
    }
});

// SEARCH FILTER
document.getElementById("search").addEventListener("keyup", function(){
    let value = this.value.toLowerCase();
    document.querySelectorAll("table tr").forEach((row, index)=>{
        if(index === 0) return;
        row.style.display = row.innerText.toLowerCase().includes(value) ? "" : "none";
    });
});
</script>

</body>
</html>
